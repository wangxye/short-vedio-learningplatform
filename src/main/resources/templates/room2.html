<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        body {
            font-family: Monospace;
            color: #fff;
            margin: 0px;
            overflow: hidden;
            background-color: #E9E9E9;

            background-size: cover;
            -moz-background-size: cover;
            -webkit-background-size: cover;
            -o-background-size: cover;
        }

        html, body {
            margin: 0;
            padding: 0;
        }

        #taskInfo {
            position: absolute;
            z-index: 2;
            background: white;
            padding: 10px;
            visibility: hidden;
        }


    </style>
</head>
<body onload="draw();">
<div id="taskInfo"></div>
<canvas id="canvas" style="display: none;">你的浏览器不支持canvas</canvas>
<canvas id="canvas2" style="display: none;">你的浏览器不支持canvas</canvas>
<div id="WebGL-output"></div>
<div id="Stats-output"></div>

<div id="label"></div>
</body>
<script src="jquery-3.5.1/jquery-3.5.1.min.js"></script>
<script src="js1/three.js"></script>
<script src="js1/loaders/OBJLoader.js"></script>
<script src="js1/controls/OrbitControls.js"></script>
<script src="js1/libs/stats.min.js"></script>
<script src="js1/libs/dat.gui.min.js"></script>
<script src="js1/loaders/MTLLoader.js"></script>
<script src="js1/loaders/DDSLoader.js"></script>
<script src="js1/controls/TrackballControls.js"></script>
<script src="js1/WebGL.js"></script>
<script th:inline="javascript">
    let img_num = 1;
    var renderer;
    var objs;
    var objs1 = [];
    let flag = 1;
    var strnow = "#";
    var bookstrnow = "#";

    function initRender() {
        renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        //告诉渲染器需要阴影效果
        renderer.setClearColor(0xffffff);
        document.body.appendChild(renderer.domElement);
    }

    var camera;

    function initCamera() {
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 40, 50);
        camera.lookAt(new THREE.Vector3(0, 0, 0));
    }

    var scene;

    function initScene() {
        scene = new THREE.Scene();
    }

    //初始化dat.GUI简化试验流程
    var gui;

    function initGui() {
        //声明一个保存需求修改的相关数据的对象
        gui = {};
        var datGui = new dat.GUI();
        //将设置属性添加到gui当中，gui.add(对象，属性，最小值，最大值）
    }

    var light;

    function initLight() {
        scene.add(new THREE.AmbientLight(0xaaaaaa));

        light = new THREE.PointLight(0xffffff);
        light.position.set(0, 100,);

        //告诉平行光需要开启阴影投射
        light.castShadow = true;

        scene.add(light);
    }

    function initModel() {


        let canvas = document.getElementById('canvas2')
        let ctx = canvas.getContext('2d')
        canvas.width = 300
        canvas.height = 300
        ctx.fillStyle = "rgba(255,165,0,0.8)";
        ctx.fillRect(0, 0, 300, 300)
        ctx.fillStyle = "#fff";
        ctx.font = 'normal 18pt "楷体"'
        ctx.fillText('用户个人信息', 100, 25)
        ctx.fillText('姓名：', 15, 50)
        let name = [[${name}]]
        ctx.fillText(name, 80, 50)
        ctx.fillText('所属学院：', 15, 75)
        let college = [[${college}]]
        ctx.fillText(college, 125, 75)
        ctx.fillText('所属工作室:', 15, 100)
        let studio = [[${studio}]]
        ctx.fillText(studio, 150, 100)
        ctx.fillText('等级:', 15, 125)
        var number = [[${sum}]];
        ctx.fillText(number, 80, 125)
        var myArray1 = new Array(4);
        myArray1[0] = "Ⅰ";
        myArray1[1] = "Ⅱ";
        myArray1[2] = "Ⅲ";
        myArray1[3] = "Ⅳ";
        var myArray2 = new Array(6);
        myArray2[0] = "倔强青铜";
        myArray2[1] = "秩序白银";
        myArray2[2] = "荣耀黄金";
        myArray2[3] = "尊贵铂金";
        myArray2[4] = "永恒钻石";
        myArray2[5] = "至尊星耀";
        ctx.fillText('当前段位：', 15, 150);
        var duanwei = "#";
        if (number <= 3 && number > 0) {
            duanwei = myArray2[0] + myArray1[number - 1];
            ctx.fillText(duanwei, 125, 150);
        } else if (number > 3) {
            var big = number - 3;
            duanwei = myArray2[((big - (big % 4)) / 4) + 1] + myArray1[big % 4 - 1];
            ctx.fillText(duanwei, 125, 150);
        }

        let url = canvas.toDataURL('image/png');

        let geometry1 = new THREE.PlaneGeometry(30, 30)
        let texture = THREE.ImageUtils.loadTexture(url, null, function (t) {
        })

        let material1 = new THREE.MeshBasicMaterial({
            map: texture,
            side: THREE.DoubleSide,
            opacity: 1,
            transparent: true,
        })

        let rect = new THREE.Mesh(geometry1, material1)
        rect.position.y = 18;//14.5
        rect.position.x = -25.5;
        rect.position.z = 7;
        rect.scale.set(0.15, 0.15, 0.15);
        scene.add(rect)


        var onProgress = function (xhr) {
            console.log(xhr)
            if (xhr.lengthComputable) {
                var percentComplete = xhr.loaded / xhr.total * 100;
                console.log(Math.round(percentComplete, 2) + '% downloaded');
            }
        };

        var onError = function (xhr) {
        };

        THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());

        if (number % 4 != 0 && number > 0) {
            var numbers = number % 4;
        } else {
            numbers = 4;
        }
        for (var l = 1; l <= numbers; l++) {
            Model_load(l);
        }

        function Model_load(k) {
            var mtlLoader = new THREE.MTLLoader();
            mtlLoader.setPath('models2/');
            mtlLoader.load(k + '.mtl', function (materials) {
                materials.preload();
                var objLoader = new THREE.OBJLoader();
                objLoader.setMaterials(materials);
                objLoader.setPath('models2/');
                objLoader.load(k + '.obj', function (object) {
                    object.name = k;
                    object.position.y = 12.5;
                    object.position.x = -25.5;
                    object.position.z = 7;
                    object.scale.set(0.6, 0.6, 0.6);
                    object.rotation.set(0, -1.6, 0);//1.45
                    scene.add(object);

                }, onProgress, onError);

            });
        }

        var onProgress = function (xhr) {
            console.log(xhr)
            if (xhr.lengthComputable) {
                var percentComplete = xhr.loaded / xhr.total * 100;
                console.log(Math.round(percentComplete, 2) + '% downloaded');
            }
        };

        var onError = function (xhr) {
        };

        var onProgress = function (xhr) {
            console.log(xhr)
            if (xhr.lengthComputable) {
                var percentComplete = xhr.loaded / xhr.total * 100;
                console.log(Math.round(percentComplete, 2) + '% downloaded');
            }
        };
        var onError = function (xhr) {
        };
        THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());

        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('renwu.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('renwu.obj', function (object) {
                object.name = "renwu";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('pingmian.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('pingmian.obj', function (object) {
                object.name = "pingmian";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('shujia.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('shujia.obj', function (object) {
                object.name = "shujia";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('zhuomian1.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('zhuomian1.obj', function (object) {
                object.name = "zhuomian1";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('zhuomian2.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('zhuomian2.obj', function (object) {
                object.name = "zhuomian2";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('pingmu.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('pingmu.obj', function (object) {
                object.name = "pingmu";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('dianzishu.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('dianzishu.obj', function (object) {
                object.name = "dianzishu";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('zhuomian3.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('zhuomian3.obj', function (object) {
                object.name = "zhuomian3";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('book1.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('book1.obj', function (object) {
                object.name = "book1";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('book2.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('book2.obj', function (object) {
                object.name = "book2";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('book3.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('book3.obj', function (object) {
                object.name = "book3";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('book4.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('book4.obj', function (object) {
                object.name = "book4";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('book5.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('book5.obj', function (object) {
                object.name = "book5";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('book6.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('book6.obj', function (object) {
                object.name = "book6";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('book7.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('book7.obj', function (object) {
                object.name = "book7";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('book8.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('book8.obj', function (object) {
                object.name = "book8";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('dianzishu1.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('dianzishu1.obj', function (object) {
                object.name = "dianzishu1";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('dianzishu2.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('dianzishu2.obj', function (object) {
                object.name = "dianzishu2";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('dianzishu3.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('dianzishu3.obj', function (object) {
                object.name = "dianzishu3";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('dianzishu4.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('dianzishu4.obj', function (object) {
                object.name = "dianzishu4";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('dianzishu5.mtl', function (materials) {

            materials.preload();

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('dianzishu5.obj', function (object) {
                object.name = "dianzishu5";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);

            }, onProgress, onError);

        });
        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath('models2/');
        mtlLoader.load('dianzishu6.mtl', function (materials) {
            materials.preload();
            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('models2/');
            objLoader.load('dianzishu6.obj', function (object) {
                object.name = "dianzishu6";
                object.position.y = -0.5;
                object.scale.set(3, 3, 3);
                scene.add(object);
            }, onProgress, onError);
        });
    }

    //初始化性能插件
    var stats;

    function initStats() {
        stats = new Stats();
        document.body.appendChild(stats.dom);
    }

    //用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放
    var controls;

    function initControls() {

        controls = new THREE.OrbitControls(camera, renderer.domElement);

        // 如果使用animate方法时，将此函数删除
        //controls.addEventListener( 'change', render );
        // 使动画循环使用时阻尼或自转 意思是否有惯性
        controls.enableDamping = true;
        //动态阻尼系数 就是鼠标拖拽旋转灵敏度
        //controls.dampingFactor = 0.25;
        //是否可以缩放
        controls.enableZoom = true;
        //是否自动旋转
        //controls.autoRotate = true;
        //设置相机距离原点的最远距离
        controls.minDistance = 1;
        //设置相机距离原点的最远距离
        controls.maxDistance = 200;
        //是否开启右键拖拽
        controls.enablePan = true;
    }

    function render() {

        renderer.render(scene, camera);
    }

    //窗口变动触发的函数
    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        render();
        renderer.setSize(window.innerWidth, window.innerHeight);

    }

    function animate() {
        //更新控制器
        render();


        //更新性能插件
        stats.update();

        controls.update();

        requestAnimationFrame(animate);
    }

    function draw() {
        initGui();
        initRender();
        initScene();
        initCamera();
        initLight();
        initModel();
        initControls();
        initStats();
        animate();
        window.onresize = onWindowResize;
    }

    var watchingVideoId = -1;
    var watchingBookId = -1;

    function onMouseClick(event) {
        var mesh2;
        var raycaster = new THREE.Raycaster();
        var mouse = new THREE.Vector2();
        //通过鼠标点击的位置计算出raycaster所需要的点的位置，以屏幕中心为原点，值的范围为-1到1.

        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        // 通过鼠标点的位置和当前相机的矩阵计算出raycaster
        raycaster.setFromCamera(mouse, camera);
        //找到场景中所有外部模型
        var scensObjs = [];
        scene.children.forEach(child => {
            for (var i = 0; i < child.children.length; i++) {
                var obj = child.children[i];
                scensObjs.push(obj);

            }
        });
        // 获取raycaster直线和所有模型相交的数组集合

        var intersects = raycaster.intersectObjects(scensObjs);
        var intersect = intersects[0];
        if (intersect.object instanceof THREE.Mesh) {
            var obj = intersect.object.parent;
            //if语句
            if (obj.name == "xdianzishu") {
                scene.remove(obj);
                scene.remove(quanjushangfan);
                scene.remove(quanjuxiafan)
                scene.remove(meshdianzishu1);
                camera.position.set(0, 40, 50);
                controls.target = new THREE.Vector3(0, 0, 0);
                console.log("x")
                window.location.href = "/room?userId=" + [[${userId}]] + "&studioId=" + [[${studioId}]] + "&taskId=-1" + "&videoId=" + watchingVideoId + "&bookId=" + watchingBookId;
            }
            if (obj.name == "x") {
                video.muted = true;
                scene.remove(obj);
                scene.remove(meshvideo);
                camera.position.set(0, 40, 50);
                controls.target = new THREE.Vector3(0, 0, 0);
                console.log("x")
                window.location.href = "/room?userId=" + [[${userId}]] + "&studioId=" + [[${studioId}]] + "&taskId=-1" + "&videoId=" + watchingVideoId +"&bookId=" + watchingBookId;
            }

            var videos = [[${videos}]];
            var len = videos.length;
            var str = "#";
            if (obj.name == "book1" && len >= 1) {
                str = "/videos/" + videos[0].url;
                watchingVideoId = videos[0].videoId;
            }
            if (obj.name == "book2" && len >= 2) {
                str = "/videos/" + videos[1].url;
                watchingVideoId = videos[1].videoId;
            }
            if (obj.name == "book3" && len >= 3) {
                str = "/videos/" + videos[2].url;
                watchingVideoId = videos[2].videoId;
            }
            if (obj.name == "book4" && len >= 4) {
                str = "/videos/" + videos[3].url;
                watchingVideoId = videos[3].videoId;
            }
            if (obj.name == "book5" && len >= 5) {
                str = "/videos/" + videos[4].url;
                watchingVideoId = videos[4].videoId;
            }
            if (obj.name == "book6" && len >= 6) {
                str = "/videos/" + videos[5].url;
                watchingVideoId = videos[5].videoId;
            }
            if (obj.name == "book7" && len >= 7) {
                str = "/videos/" + videos[6].url;
                watchingVideoId = videos[6].videoId;
            }
            if (obj.name == "book8" && len >= 8) {
                str = "/videos/" + videos[7].url;
                watchingVideoId = videos[7].videoId;
            }
            var books = [[${books}]];
            var bookstr = "#";
            if (obj.name == "dianzishu1") {
                bookstr = 'models2/pdf/' + books[0].url;
                // console.log("bookstr:" + bookstr);
                watchingBookId = books[0].bookId;
            }
            if (obj.name == "dianzishu2") {
                bookstr = 'models2/pdf/' + books[1].url;
                // console.log("bookstr:" + bookstr);
                watchingBookId = books[1].bookId;
            }
            if (obj.name == "dianzishu3") {
                bookstr = 'models2/pdf/' + books[2].url;
                watchingBookId = books[2].bookId;
            }
            if (obj.name == "dianzishu4") {
                bookstr = 'models2/pdf/' + books[3].url;
                watchingBookId = books[3].bookId;
            }
            if (obj.name == "dianzishu5") {
                bookstr = 'models2/pdf/' + books[4].url;
                watchingBookId = books[4].bookId;
            }
            if (obj.name == "dianzishu6") {
                bookstr = 'models2/pdf/' + books[5].url;
                watchingBookId = books[5].bookId;
            }
            if (obj.name == "renwu") {
                var onetask = [[${onetask}]];
                if (onetask.iftask == "no") href = "/room?userId=" + [[${userId}]] + "&studioId=" + [[${studioId}]] + "&taskId=-1" + "&videoId=-1&bookId=-1";
                else href = "/room?userId=" + [[${userId}]] + "&studioId=" + [[${studioId}]] + "&taskId=" + onetask.taskId + "&videoId=-1&bookId=-1";
                window.location.href = href;
            }
            if (obj.name == "zhuomian1") {//做习题
                href = "/exercise?userId=" + [[${userId}]] + "&studioId=" + [[${studioId}]];
                window.location.href = href;
            }
            if (obj.name == "shangfan") {
                scene.remove(meshdianzishu1)
                var geometry = new THREE.PlaneGeometry(67, 67);
                // TextureLoader创建一个纹理加载器对象，可以加载图片作为几何体纹理
                var textureLoader = new THREE.TextureLoader();
                // 执行load方法，加载纹理贴图成功后，返回一个纹理对象Texture
                textureLoader.load(bookstrnow + "/" + img_num + ".jpg", function (texture) {
                    var material = new THREE.MeshLambertMaterial({

                        map: texture,//设置颜色贴图属性值
                    });
                    var mesh = new THREE.Mesh(geometry, material); //网格模型对象Mesh
                    mesh.position.y = 14.5;
                    mesh.position.x = -10.5;
                    mesh.position.z = 7;
                    mesh.scale.set(0.2, 0.2, 0.2);
                    scene.add(mesh); //网格模型添加到场景中
                    meshdianzishu1 = mesh;

                })
                img_num--;
            }
            if (obj.name == "xiafan") {
                scene.remove(meshdianzishu1)
                var geometry = new THREE.PlaneGeometry(67, 67);
                // TextureLoader创建一个纹理加载器对象，可以加载图片作为几何体纹理
                var textureLoader = new THREE.TextureLoader();
                // 执行load方法，加载纹理贴图成功后，返回一个纹理对象Texture
                img_num++;
                textureLoader.load(bookstrnow + "/" + img_num + ".jpg", function (texture) {
                    var material = new THREE.MeshLambertMaterial({
                        map: texture,//设置颜色贴图属性值
                    });
                    var mesh = new THREE.Mesh(geometry, material); //网格模型对象Mesh
                    mesh.position.y = 14.5;
                    mesh.position.x = -10.5;
                    mesh.position.z = 7;
                    mesh.scale.set(0.2, 0.2, 0.2);
                    scene.add(mesh); //网格模型添加到场景中
                    meshdianzishu1 = mesh;
                })
            }
            if (obj.name == "houtui") {
                scene.remove(meshvideo);
                video.muted = true;
                let time = video.currentTime
                video = document.createElement('video');
                video.src = strnow; // 设置视频地址
                console.log(strnow);
                video.currentTime = time + 30;
                video.autoplay = "autoplay"; //要设置播放
                if (sum >= 30) {
                    quanjujindutiao.position.x += num * 30;
                    sum = sum - 30;
                }
                var texture = new THREE.VideoTexture(video)
                var geometry = new THREE.PlaneGeometry(125, 67);
                var material = new THREE.MeshPhongMaterial({
                    map: texture,
                });
                var mesh = new THREE.Mesh(geometry, material); //网格模型对象Mesh
                mesh.position.y = 14.5;
                mesh.position.x = -10.5;
                mesh.position.z = 7;
                mesh.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh); //网格模型添加到场景中
                meshvideo = mesh;
            }
            if (obj.name == "qianjin") {
                scene.remove(meshvideo);
                video.muted = true;
                let time = video.currentTime
                video = document.createElement('video');
                video.src = strnow; // 设置视频地址
                console.log(strnow);
                video.currentTime = time - 30;
                video.autoplay = "autoplay"; //要设置播放
                if (sum <= parseInt(alltime) - 30) {
                    quanjujindutiao.position.x -= num * 30;
                    sum = sum + 30;
                }
                var texture = new THREE.VideoTexture(video)
                var geometry = new THREE.PlaneGeometry(125, 67);
                var material = new THREE.MeshPhongMaterial({
                    map: texture,
                });
                var mesh = new THREE.Mesh(geometry, material); //网格模型对象Mesh
                mesh.position.y = 14.5;
                mesh.position.x = -10.5;
                mesh.position.z = 7;
                mesh.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh); //网格模型添加到场景中
                meshvideo = mesh;
            }
            if (obj.name == "pause") {
                scene.remove(meshvideo);
                video.muted = true;
                let time = video.currentTime
                video = document.createElement('video');
                video.src = strnow; // 设置视频地址
                video.currentTime = time;
                console.log(strnow);
                //video.autoplay = "autoplay"; //要设置播放
                if (flag == 1) {
                    flag++;
                    clearInterval(shiping1);
                } else {
                    video.autoplay = "autoplay"; //要设置播放
                    flag = 1;
                    shiping1 = window.setInterval(function () {
                        quanjujindutiao.position.x += num * 3 / 3;
                        sum--;
                        if (sum <= 0) {
                            clearInterval(shiping1);
                        }
                    }, 1000);
                }
                var texture = new THREE.VideoTexture(video)
                var geometry = new THREE.PlaneGeometry(125, 67);
                var material = new THREE.MeshPhongMaterial({
                    map: texture,
                });
                var mesh = new THREE.Mesh(geometry, material); //网格模型对象Mesh
                mesh.position.y = 14.5;
                mesh.position.x = -10.5;
                mesh.position.z = 7;
                mesh.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh); //网格模型添加到场景中
                meshvideo = mesh;

            }

            if (bookstr != "#") {
                var onProgress = function (xhr) {
                    console.log(xhr)
                    if (xhr.lengthComputable) {
                        var percentComplete = xhr.loaded / xhr.total * 100;
                        console.log(Math.round(percentComplete, 2) + '% downloaded');
                    }
                };
                var onError = function (xhr) {
                };
                THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());

                bookstrnow = bookstr;
                var geometry = new THREE.PlaneGeometry(67, 67);//125.67
                var textureLoader = new THREE.TextureLoader();
                textureLoader.load(bookstrnow + '/' + img_num + '.jpg', function (texture) {
                    var material = new THREE.MeshLambertMaterial({
                        map: texture,
                    });
                    var mesh = new THREE.Mesh(geometry, material);
                    mesh.position.y = 14.5;
                    mesh.position.x = -10.5;
                    mesh.position.z = 7;
                    mesh.scale.set(0.2, 0.2, 0.2);
                    scene.add(mesh);
                    meshdianzishu1 = mesh;
                    camera.position.set(-16, 10, 35);
                    controls.target = new THREE.Vector3(-16, 10, 0);
                })
                THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());
                //关闭按钮
                var mtlLoader = new THREE.MTLLoader();
                mtlLoader.setPath('models2/');
                mtlLoader.load('x.mtl', function (materials) {
                    materials.preload();
                    var objLoader = new THREE.OBJLoader();
                    objLoader.setMaterials(materials);
                    objLoader.setPath('models2/');
                    objLoader.load('x.obj', function (object) {
                        object.name = "xdianzishu";
                        object.position.y = -0.5;
                        object.position.x = +7;
                        object.scale.set(3, 3, 3);
                        scene.add(object);
                    }, onProgress, onError);

                });

                //上翻按钮
                var mtlLoader = new THREE.MTLLoader();
                mtlLoader.setPath('models2/');
                mtlLoader.load('shangfan.mtl', function (materials) {

                    materials.preload();

                    var objLoader = new THREE.OBJLoader();
                    objLoader.setMaterials(materials);
                    objLoader.setPath('models2/');
                    objLoader.load('shangfan.obj', function (object) {
                        object.name = "shangfan";
                        object.position.y = -0.5;
                        object.position.x = +24;
                        object.scale.set(3, 3, 3);
                        quanjushangfan = object;
                        scene.add(object);
                    }, onProgress, onError);
                });
                //下翻按钮
                var mtlLoader = new THREE.MTLLoader();
                mtlLoader.setPath('models2/');
                mtlLoader.load('xiafan.mtl', function (materials) {
                    materials.preload();
                    var objLoader = new THREE.OBJLoader();
                    objLoader.setMaterials(materials);
                    objLoader.setPath('models2/');
                    objLoader.load('xiafan.obj', function (object) {
                        object.name = "xiafan";
                        object.position.y = -0.5;
                        object.position.x = +24;
                        object.scale.set(3, 3, 3);
                        scene.add(object);
                        quanjuxiafan = object
                    }, onProgress, onError);
                });
            }

            if (str != "#") {

                var onProgress = function (xhr) {
                    console.log(xhr)
                    if (xhr.lengthComputable) {
                        var percentComplete = xhr.loaded / xhr.total * 100;
                        console.log(Math.round(percentComplete, 2) + '% downloaded');
                    }
                };
                var onError = function (xhr) {
                };
                THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());

                var mtlLoader = new THREE.MTLLoader();
                mtlLoader.setPath('models2/');
                mtlLoader.load('x.mtl', function (materials) {
                    materials.preload();
                    var objLoader = new THREE.OBJLoader();
                    objLoader.setMaterials(materials);
                    objLoader.setPath('models2/');
                    objLoader.load('x.obj', function (object) {
                        object.name = "x";
                        object.position.y = -0.5;
                        object.scale.set(3, 3, 3);
                        scene.add(object);

                    }, onProgress, onError);

                });
                var mtlLoader = new THREE.MTLLoader();
                mtlLoader.setPath('models2/');
                mtlLoader.load('pause.mtl', function (materials) {

                    materials.preload();

                    var objLoader = new THREE.OBJLoader();
                    objLoader.setMaterials(materials);
                    objLoader.setPath('models2/');
                    objLoader.load('pause.obj', function (object) {
                        object.name = "pause";
                        object.position.y = -0.5;
                        object.scale.set(3, 3, 3);
                        scene.add(object);
                        quanjupause = object;
                    }, onProgress, onError);

                });
                var mtlLoader = new THREE.MTLLoader();
                mtlLoader.setPath('models2/');
                mtlLoader.load('qianjin.mtl', function (materials) {

                    materials.preload();

                    var objLoader = new THREE.OBJLoader();
                    objLoader.setMaterials(materials);
                    objLoader.setPath('models2/');
                    objLoader.load('qianjin.obj', function (object) {
                        object.name = "qianjin";
                        object.position.y = -0.5;
                        object.scale.set(3, 3, 3);
                        scene.add(object);
                        quanjuqianjin = object;
                    }, onProgress, onError);

                });
                var mtlLoader = new THREE.MTLLoader();
                mtlLoader.setPath('models2/');
                mtlLoader.load('houtui.mtl', function (materials) {
                    materials.preload();
                    var objLoader = new THREE.OBJLoader();
                    objLoader.setMaterials(materials);
                    objLoader.setPath('models2/');
                    objLoader.load('houtui.obj', function (object) {
                        object.name = "houtui";
                        object.position.y = -0.5;
                        object.scale.set(3, 3, 3);
                        scene.add(object);
                        quanjuhoutui = object;
                    }, onProgress, onError);

                });
                var mtlLoader = new THREE.MTLLoader();
                mtlLoader.setPath('models2/');
                mtlLoader.load('jindu.mtl', function (materials) {
                    materials.preload();
                    var objLoader = new THREE.OBJLoader();
                    objLoader.setMaterials(materials);
                    objLoader.setPath('models2/');
                    objLoader.load('jindu.obj', function (object) {
                        object.name = "jindu";
                        object.position.y = -0.5;
                        object.scale.set(3, 3, 3);
                        scene.add(object);
                        quanjujindu = object;
                        console.log(quanjujindu.width)
                    }, onProgress, onError);

                });
                var mtlLoader = new THREE.MTLLoader();
                mtlLoader.setPath('models2/');
                mtlLoader.load('jindutiao.mtl', function (materials) {
                    materials.preload();
                    var objLoader = new THREE.OBJLoader();
                    objLoader.setMaterials(materials);
                    objLoader.setPath('models2/');
                    objLoader.load('jindutiao.obj', function (object) {
                        object.name = "jindutiao";
                        object.position.y = -0.5;
                        object.scale.set(3, 3, 3);
                        scene.add(object);
                        quanjujindutiao = object;
                        video.oncanplay = function () {
                            //sum,num,alltime设置全局变量为前进后退暂停
                            alltime = video.duration;
                            sum = parseInt(alltime);
                            num = 3.8 / alltime;
                            num = num.toFixed(4);
                            shiping1 = window.setInterval(function () {
                                object.position.x += num * 3 / 3;
                                sum--;
                                if (sum <= 0) {
                                    clearInterval(shiping1);
                                }
                                console.log("")
                            }, 1000);
                            console.log("开始")
                            console.log(alltime)
                            console.log(num)
                        }
                    }, onProgress, onError);

                });
                strnow = str;
                video = document.createElement('video');
                video.src = str; // 设置视频地址
                video.autoplay = "autoplay"; //要设置播放
                // video对象作为VideoTexture参数创建纹理对象
                var texture = new THREE.VideoTexture(video)
                var geometry = new THREE.PlaneGeometry(125, 67);
                var material = new THREE.MeshPhongMaterial({
                    map: texture,
                });
                var mesh = new THREE.Mesh(geometry, material); //网格模型对象Mesh
                mesh.position.y = 14.5;
                mesh.position.x = -10.5;
                mesh.position.z = 7;
                mesh.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh); //网格模型添加到场景中
                meshvideo = mesh;
                camera.position.set(-16, 10, 35);
                controls.target = new THREE.Vector3(-16, 10, 0);
            }
        }
    }

    function onMouseMove(event) {
        var raycaster = new THREE.Raycaster();
        var mouse = new THREE.Vector2();
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        raycaster.setFromCamera(mouse, camera);
        var scensObjs = [];
        scene.children.forEach(child => {
            for (var i = 0; i < child.children.length; i++) {
                var obj = child.children[i];
                scensObjs.push(obj);

            }
        });
        var intersects = raycaster.intersectObjects(scensObjs);
        var intersect = intersects[0];
        if (intersect.object instanceof THREE.Mesh) {
            var obj = intersect.object.parent;
            var videos = [[${videos}]];
            len = videos.length;
            if (obj.name == "book1" && len >= 1) {

                var canvas = document.createElement("canvas");

                canvas.width = 128;
                canvas.height = 32;
                var c = canvas.getContext('2d');
// 矩形区域填充背景
                c.fillStyle = "#3480C4";
                c.fillRect(0, 0, 128, 32);
// 文字
                c.beginPath();
                c.translate(64, 16);
                c.fillStyle = "#000000"; //文本填充颜色
                c.font = "bold 20px 宋体"; //字体样式设置
                c.textBaseline = "middle"; //文本与fillText定义的纵坐标
                c.textAlign = "center"; //文本居中(以fillText定义的横坐标)
                var str = "";
                str = videos[0].name;
                c.fillText(str, 0, 0);
                var texture = new THREE.CanvasTexture(canvas);
//打印纹理对象的image属性
// console.log(texture.image);
//矩形平面
                var geometry = new THREE.PlaneGeometry(18, 18);

                var material = new THREE.MeshPhongMaterial({
                    map: texture, // 设置纹理贴图
                });
// 创建一个矩形平面网模型，Canvas画布作为矩形网格模型的纹理贴图
                var mesh2 = new THREE.Mesh(geometry, material);
                mesh2.position.y = 10;
                mesh2.position.x = 17;
                mesh2.position.z = 13;
                mesh2.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh2);
                var mesh3 = mesh2;
                setTimeout(function () {
                    scene.remove(mesh3);
                }, 100);
                console.log("显示文本")
            }


            if (obj.name == "book2" && len >= 2) {
                var canvas = document.createElement("canvas");
                canvas.width = 128;
                canvas.height = 32;
                var c = canvas.getContext('2d');
// 矩形区域填充背景
                c.fillStyle = "#3480C4";
                c.fillRect(0, 0, 128, 32);
// 文字
                c.beginPath();
                c.translate(64, 16);
                c.fillStyle = "#000000"; //文本填充颜色
                c.font = "bold 20px 宋体"; //字体样式设置
                c.textBaseline = "middle"; //文本与fillText定义的纵坐标
                c.textAlign = "center"; //文本居中(以fillText定义的横坐标)
                var str = "";
                str = videos[1].name;
                c.fillText(str, 0, 0);
                var texture = new THREE.CanvasTexture(canvas);
//打印纹理对象的image属性
// console.log(texture.image);
//矩形平面
                var geometry = new THREE.PlaneGeometry(18, 18);

                var material = new THREE.MeshPhongMaterial({
                    map: texture, // 设置纹理贴图
                });
// 创建一个矩形平面网模型，Canvas画布作为矩形网格模型的纹理贴图
                var mesh2 = new THREE.Mesh(geometry, material);
                mesh2.position.y = 10;
                mesh2.position.x = 20;
                mesh2.position.z = 13;
                mesh2.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh2);
                var mesh3 = mesh2;
                setTimeout(function () {
                    scene.remove(mesh3);
                }, 1000);//1s
                console.log("显示文本")

            }
            if (obj.name == "book3" && len >= 3) {

                var canvas = document.createElement("canvas");

                canvas.width = 128;
                canvas.height = 32;
                var c = canvas.getContext('2d');
// 矩形区域填充背景
                c.fillStyle = "#3480C4";
                c.fillRect(0, 0, 128, 32);
// 文字
                c.beginPath();
                c.translate(64, 16);
                c.fillStyle = "#000000"; //文本填充颜色
                c.font = "bold 20px 宋体"; //字体样式设置
                c.textBaseline = "middle"; //文本与fillText定义的纵坐标
                c.textAlign = "center"; //文本居中(以fillText定义的横坐标)

                var str = "";
                str = videos[2].name;

                c.fillText(str, 0, 0);

                var texture = new THREE.CanvasTexture(canvas);
//打印纹理对象的image属性
// console.log(texture.image);
//矩形平面
                var geometry = new THREE.PlaneGeometry(18, 18);

                var material = new THREE.MeshPhongMaterial({
                    map: texture, // 设置纹理贴图
                });
// 创建一个矩形平面网模型，Canvas画布作为矩形网格模型的纹理贴图
                var mesh2 = new THREE.Mesh(geometry, material);
                mesh2.position.y = 10;
                mesh2.position.x = 23;
                mesh2.position.z = 13;
                mesh2.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh2);
                var mesh3 = mesh2;
                setTimeout(function () {
                    scene.remove(mesh3);
                }, 1000);
                console.log("显示文本")

            }
            if (obj.name == "book4" && len >= 4) {

                var canvas = document.createElement("canvas");

                canvas.width = 128;
                canvas.height = 32;
                var c = canvas.getContext('2d');
// 矩形区域填充背景
                c.fillStyle = "#3480C4";
                c.fillRect(0, 0, 128, 32);
// 文字
                c.beginPath();
                c.translate(64, 16);
                c.fillStyle = "#000000"; //文本填充颜色
                c.font = "bold 20px 宋体"; //字体样式设置
                c.textBaseline = "middle"; //文本与fillText定义的纵坐标
                c.textAlign = "center"; //文本居中(以fillText定义的横坐标)

                var str = "";
                str = videos[3].name;

                c.fillText(str, 0, 0);

                var texture = new THREE.CanvasTexture(canvas);
//打印纹理对象的image属性
// console.log(texture.image);
//矩形平面
                var geometry = new THREE.PlaneGeometry(18, 18);

                var material = new THREE.MeshPhongMaterial({
                    map: texture, // 设置纹理贴图
                });
// 创建一个矩形平面网模型，Canvas画布作为矩形网格模型的纹理贴图
                var mesh2 = new THREE.Mesh(geometry, material);
                mesh2.position.y = 10;
                mesh2.position.x = 26;
                mesh2.position.z = 13;
                mesh2.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh2);
                var mesh3 = mesh2;
                setTimeout(function () {
                    scene.remove(mesh3);
                }, 1000);
                console.log("显示文本")

            }
            if (obj.name == "book5" && len >= 5) {

                var canvas = document.createElement("canvas");

                canvas.width = 128;
                canvas.height = 32;
                var c = canvas.getContext('2d');
// 矩形区域填充背景
                c.fillStyle = "#3480C4";
                c.fillRect(0, 0, 128, 32);
// 文字
                c.beginPath();
                c.translate(64, 16);
                c.fillStyle = "#000000"; //文本填充颜色
                c.font = "bold 20px 宋体"; //字体样式设置
                c.textBaseline = "middle"; //文本与fillText定义的纵坐标
                c.textAlign = "center"; //文本居中(以fillText定义的横坐标)

                var str = "";
                str = videos[4].name;

                c.fillText(str, 0, 0);

                var texture = new THREE.CanvasTexture(canvas);
//打印纹理对象的image属性
// console.log(texture.image);
//矩形平面
                var geometry = new THREE.PlaneGeometry(18, 18);

                var material = new THREE.MeshPhongMaterial({
                    map: texture, // 设置纹理贴图
                });
// 创建一个矩形平面网模型，Canvas画布作为矩形网格模型的纹理贴图
                var mesh2 = new THREE.Mesh(geometry, material);
                mesh2.position.y = 7;
                mesh2.position.x = 17;
                mesh2.position.z = 13;
                mesh2.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh2);
                var mesh3 = mesh2;
                setTimeout(function () {
                    scene.remove(mesh3);
                }, 1000);
                console.log("显示文本")

            }
            if (obj.name == "book6" && len >= 6) {

                var canvas = document.createElement("canvas");

                canvas.width = 128;
                canvas.height = 32;
                var c = canvas.getContext('2d');
// 矩形区域填充背景
                c.fillStyle = "#3480C4";
                c.fillRect(0, 0, 128, 32);
// 文字
                c.beginPath();
                c.translate(64, 16);
                c.fillStyle = "#000000"; //文本填充颜色
                c.font = "bold 20px 宋体"; //字体样式设置
                c.textBaseline = "middle"; //文本与fillText定义的纵坐标
                c.textAlign = "center"; //文本居中(以fillText定义的横坐标)

                var str = "";
                str = videos[5].name;

                c.fillText(str, 0, 0);

                var texture = new THREE.CanvasTexture(canvas);
//打印纹理对象的image属性
// console.log(texture.image);
//矩形平面
                var geometry = new THREE.PlaneGeometry(18, 18);

                var material = new THREE.MeshPhongMaterial({
                    map: texture, // 设置纹理贴图
                });
// 创建一个矩形平面网模型，Canvas画布作为矩形网格模型的纹理贴图
                var mesh2 = new THREE.Mesh(geometry, material);
                mesh2.position.y = 7;
                mesh2.position.x = 20;
                mesh2.position.z = 13;
                mesh2.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh2);
                var mesh3 = mesh2;
                setTimeout(function () {
                    scene.remove(mesh3);
                }, 1000);
                console.log("显示文本")

            }
            if (obj.name == "book7" && len >= 7) {

                var canvas = document.createElement("canvas");

                canvas.width = 128;
                canvas.height = 32;
                var c = canvas.getContext('2d');
// 矩形区域填充背景
                c.fillStyle = "#3480C4";
                c.fillRect(0, 0, 128, 32);
// 文字
                c.beginPath();
                c.translate(64, 16);
                c.fillStyle = "#000000"; //文本填充颜色
                c.font = "bold 20px 宋体"; //字体样式设置
                c.textBaseline = "middle"; //文本与fillText定义的纵坐标
                c.textAlign = "center"; //文本居中(以fillText定义的横坐标)

                var str = "";
                str = videos[6].name;

                c.fillText(str, 0, 0);

                var texture = new THREE.CanvasTexture(canvas);
//打印纹理对象的image属性
// console.log(texture.image);
//矩形平面
                var geometry = new THREE.PlaneGeometry(18, 18);

                var material = new THREE.MeshPhongMaterial({
                    map: texture, // 设置纹理贴图
                });
// 创建一个矩形平面网模型，Canvas画布作为矩形网格模型的纹理贴图
                var mesh2 = new THREE.Mesh(geometry, material);
                mesh2.position.y = 7;
                mesh2.position.x = 23;
                mesh2.position.z = 13;
                mesh2.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh2);
                var mesh3 = mesh2;
                setTimeout(function () {
                    scene.remove(mesh3);
                }, 1000);
                console.log("显示文本")

            }
            if (obj.name == "book8" && len >= 8) {

                var canvas = document.createElement("canvas");

                canvas.width = 128;
                canvas.height = 32;
                var c = canvas.getContext('2d');
// 矩形区域填充背景
                c.fillStyle = "#3480C4";
                c.fillRect(0, 0, 128, 32);
// 文字
                c.beginPath();
                c.translate(64, 16);
                c.fillStyle = "#000000"; //文本填充颜色
                c.font = "bold 20px 宋体"; //字体样式设置
                c.textBaseline = "middle"; //文本与fillText定义的纵坐标
                c.textAlign = "center"; //文本居中(以fillText定义的横坐标)

                var str = "";
                str = videos[7].name;

                c.fillText(str, 0, 0);

                var texture = new THREE.CanvasTexture(canvas);
//打印纹理对象的image属性
// console.log(texture.image);
//矩形平面
                var geometry = new THREE.PlaneGeometry(18, 18);

                var material = new THREE.MeshPhongMaterial({
                    map: texture, // 设置纹理贴图
                });
// 创建一个矩形平面网模型，Canvas画布作为矩形网格模型的纹理贴图
                var mesh2 = new THREE.Mesh(geometry, material);
                mesh2.position.y = 7;
                mesh2.position.x = 26;
                mesh2.position.z = 13;
                mesh2.scale.set(0.2, 0.2, 0.2);
                scene.add(mesh2);
                var mesh3 = mesh2;
                setTimeout(function () {
                    scene.remove(mesh3);
                }, 1000);
                console.log("显示文本")
            }

//             if (obj.name == "dianzishu1") {
//                 var canvas = document.createElement("canvas");
//
//                 canvas.width = 128;
//                 canvas.height = 32;
//                 var c = canvas.getContext('2d');
// // 矩形区域填充背景
//                 c.fillStyle = "#3480C4";
//                 c.fillRect(0, 0, 128, 32);
// // 文字
//                 c.beginPath();
//                 c.translate(64, 16);
//                 c.fillStyle = "#000000"; //文本填充颜色
//                 c.font = "bold 20px 宋体"; //字体样式设置
//                 c.textBaseline = "middle"; //文本与fillText定义的纵坐标
//                 c.textAlign = "center"; //文本居中(以fillText定义的横坐标)
//                 var str = "";
//                 str = videos[7].name;
//                 c.fillText(str, 0, 0);
//                 var texture = new THREE.CanvasTexture(canvas);
// //打印纹理对象的image属性
// // console.log(texture.image);
// //矩形平面
//                 var geometry = new THREE.PlaneGeometry(18, 18);
//
//                 var material = new THREE.MeshPhongMaterial({
//                     map: texture, // 设置纹理贴图
//                 });
// // 创建一个矩形平面网模型，Canvas画布作为矩形网格模型的纹理贴图
//                 var mesh2 = new THREE.Mesh(geometry, material);
//                 mesh2.position.y = 7;
//                 mesh2.position.x = 26;
//                 mesh2.position.z = 13;
//                 mesh2.scale.set(0.2, 0.2, 0.2);
//                 scene.add(mesh2);
//                 var mesh3 = mesh2;
//                 setTimeout(function () {
//                     scene.remove(mesh3);
//                 }, 1000);
//                 console.log("显示文本")
//             }

            if (obj.name == "renwu") {
                let canvas = document.getElementById('canvas')
                let ctx = canvas.getContext('2d')
                canvas.width = 600
                canvas.height = 600
                //制作矩形
                ctx.fillStyle = "rgba(255,165,0,0.8)";
                ctx.fillRect(0, 0, 600, 600)
                //设置文字
                ctx.fillStyle = "#fff";
                ctx.font = 'normal 30pt "楷体"'
                ctx.fillText('', 100, 20)
                var str = "";

                var str0 ="职务：辅导员";
                ctx.fillText(str0, 15, 40);
                var isum=1;

                var x = [[${finishTask}]];
                var str1 =x+ "点击辅导员领取下一个任务：";
                var onetask = [[${onetask}]];
                if (onetask.iftask == "no") str1 = str1 + "无(您暂时没有可领取的任务，请等待发布)";
                else {
                    str1 = str1 + onetask.taskname;
                    str1 = str1 + " 难度：" + onetask.taskLevel + "级";
                    str1 = str1 + " 情境：" + onetask.taskDetail;
                }
                var len1 = parseInt(str1.length / 14)
                for (let i = 0; i < (len1 + 1); i++) {
                    let space = 14
                    if (i === len1) {
                        space = str1.length - len1 * 14
                    }
                   // console.log('len+' + len, 'space+' + space)
                    let word = str1.substr(i * 14, space)
                    ctx.fillText(word, 15, 40 * (i + 1+ isum))
                }
                isum+=len1+1;


                var str2 =[[${notFinishTask}]];
                var len2 = parseInt(str2.length / 14)
                for (let i = 0; i < (len2 + 1); i++) {
                    let space = 14
                    if (i === len2) {
                        space = str2.length - len2 * 14
                    }
                    // console.log('len+' + len, 'space+' + space)
                    let word = str2.substr(i * 14, space)
                    ctx.fillText(word, 15, 40 * (i + 1+isum))
                }
                isum+=len2+1;


                var str3 = [[${lastTaskInformation}]];
                var len3 = parseInt(str3.length / 14)
                for (let i = 0; i < (len3 + 1); i++) {
                    let space = 14
                    if (i === len3) {
                        space = str3.length - len3 * 14
                    }
                    // console.log('len+' + len, 'space+' + space)
                    let word = str3.substr(i * 14, space)
                    ctx.fillText(word, 15, 40 * (i + 1+isum))
                }

                /*
                let textWord = str;
                //文字换行
                let len = parseInt(textWord.length / 10)
                for (let i = 0; i < (len + 1); i++) {
                    let space = 10
                    if (i === len) {
                        space = textWord.length - len * 10
                    }
                    console.log('len+' + len, 'space+' + space)
                    let word = textWord.substr(i * 10, space)
                    ctx.fillText(word, 15, 40 * (i + 1))
                }*/
                //生成图片

                let url = canvas.toDataURL('image/png');

                //将图片构建到纹理中
                let geometry1 = new THREE.PlaneGeometry(10, 10)
                let texture = THREE.ImageUtils.loadTexture(url, null, function (t) {
                })

                let material1 = new THREE.MeshBasicMaterial({
                    map: texture,
                    side: THREE.DoubleSide,
                    opacity: 1,
                    transparent: true,
                })

                let rect = new THREE.Mesh(geometry1, material1)
                rect.position.set(16, 15, -10)
                scene.add(rect)
            }
        }
    }




    window.addEventListener('click', onMouseClick, false);
    window.addEventListener('mousemove', onMouseMove, false);

</script>
</html>

